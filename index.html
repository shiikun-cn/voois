<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VÃ¶is</title>
    <style>
        
        :root {
            --primary: #00b195;
            --secondary: #fc2537;
            --background: #07080b;
            --warning: #fc2537;
        }

        /* åŠ è½½çŠ¶æ€æ ·å¼ */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
        transform: none !important; /* ç¦ç”¨ç¼©æ”¾å½±å“ */
            background: var(--background);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 3000;
            gap: 2rem;
        }

        .status-symbol {
            width: 80px;
            height: 80px;
            position: relative;
        }

        /* åŠ è½½åŠ¨ç”» */
        .loading-symbol {
            border: 4px solid rgba(255,255,255,0.2);
            border-top-color: #fff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        /* é”™è¯¯ç¬¦å· */
        .error-symbol::before,
        .error-symbol::after {
            content: '';
            position: absolute;
            background: var(--secondary);
            left: 50%;
            top: 50%;
            width: 40px;
            height: 4px;
            border-radius: 2px;
        }
        .error-symbol::before {
            transform: translate(-50%, -50%) rotate(45deg);
        }
        .error-symbol::after {
            transform: translate(-50%, -50%) rotate(-45deg);
        }

        /* åˆ·æ–°æŒ‰é’® */
        .retry-symbol {
            border: 4px solid #fff;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            width: 60px;  /* è°ƒæ•´å°ºå¯¸ */
            height: 60px;
            background: transparent;
        }


        .retry-symbol::before {
            content: none;
        }

        .retry-symbol:hover {
            transform: scale(1.1);  /* æ‚¬åœæ—¶æ”¾å¤§ */
            border-color: var(--primary);  /* æ‚¬åœæ—¶å˜ä¸ºä¸»è‰² */
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        
        body {
            margin: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: var(--background);
            font-family: 'Kiineza', monospace;
            color: white;
            line-height: 1;
        }
                /* ç¼©æ”¾å¤„ç†ï¼šè§†å£å®½åº¦å°äº600pxæ—¶æ•´ä½“ç¼©å°è‡³50% */
        @media (max-width: 1000px) or (orientation: portrait) {
            body {
                transform: scale(0.5);
                transform-origin: top left;
                width: 200%;
            }
        }
        .read-button {
            background: none;
            border: none;
            font-size: 6.52rem;
            color: var(--primary);
            cursor: pointer;
            margin-bottom: 1.2rem;
            transition: transform 0.2s;
        }
        .read-button:hover {
            transform: scale(1.05);
            text-shadow: 
                -3px -3px 0 var(--primary),
                 3px -3px 0 var(--primary),
                -3px  3px 0 var(--primary),
                 3px  3px 0 var(--primary);
        }
        .display-box {
            width: 100vw;
            max-width: 900px;
            padding: 1rem;
            font-size: 3.5rem;
            background: #131318;
            border: none;
            border-radius: 8px;
            color: var(--primary);
            font-family: 'Kiineza', monospace;
            outline: none;
            margin-bottom: 2rem;
            caret-color: var(--primary);
        }

        .display-box::placeholder {
            color: #303030; 
            opacity: 1; /* ç¡®ä¿é¢œè‰²ä¸é€æ˜ */
        }

        .keyboard {
            display: flex;
            gap: 0.1rem;
            justify-content: center;
            max-width: 800px;
        }
        .key-column {
            display: flex;
            flex-direction: column;
            gap: 0.1rem;
        }
        .key {
            width: 5.4rem;
            height: 5.4rem;
            background: #131318;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4.2rem;
            transition: all 0.2s;
            position: relative;
            overflow: visible;
            cursor: pointer;
            font-family: 'Kiineza', monospace;
        }
        .key::after {
            content: attr(data-char);
            position: absolute;
            top: -0.7rem;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            pointer-events: none;
        }
        .key.vowel-key {
            font-size: 5.6rem;
            letter-spacing: -0.1rem;
        }
        .vowel-key::after {
            font-size: 5.6rem;
            top: -0.8rem;
        }
        
        .key.underbar-key {
            font-size: 4.2rem;
            letter-spacing: -0.1rem;
        }
        .underbar-key::after {
            font-size: 4.2rem;
            top: -1.5rem;
        }
        .key:hover { background: var(--primary); color: var(--background); }
        /* è¯­éŸ³åŒ…æç¤ºå¼¹çª—æ ·å¼ */
        .voice-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(7,8,11,0.95);
            align-items: center;
            justify-content: center;
            z-index: 2000;
            text-align: center;
            padding: 2rem;
            font-family: 'Kiineza', monospace;
        }
        .voice-prompt {
            background: #131318;
            border: 2px solid var(--primary);
            border-radius: 8px;
            padding: 1.5rem;
            max-width: 90vw;
            color: white;
            font-size: 2.2rem;
            line-height: 1.2;
            font-family: 'Kiineza', monospace;
            color: var(--warning);
        }
        .voice-prompt button {
            margin-top: 1rem;
            background: var(--primary);
            border: none;
            padding: 0.5rem 1rem;
            font-size: 1.4rem;
            border-radius: 6px;
            cursor: pointer;
            font-family: 'Kiineza', monospace;
        }
    </style>
</head>
<body>
    <div class="loading-overlay">
        <div class="status-symbol loading-symbol"></div>
        <div class="status-symbol error-symbol" style="display: none;"></div>
        <button class="status-symbol retry-symbol" style="display: none;"></button>
    </div>
    <button class="read-button" id="readBtn">ğŸ—£ï¸</button>
    <input type="text" id="display" class="display-box" maxlength="80" placeholder="lO sivOxis/u maz/e vOz/ot/i...">
    <div id="keyboard" class="keyboard"></div>
    <!-- è¯­éŸ³æç¤ºå¼¹çª— -->
    <div id="voiceOverlay" class="voice-overlay">
        <div class="voice-prompt">
            <p>âŒvOsutâŒ</p>
            <p>lO tigAxun/a masIn/u ğŸ–¥ï¸ s/ot/i.</p>
            <button id="voiceDismiss">mal/o kak/u n/og/i.</button>
        </div>
    </div>
<script>


async function checkFontLoaded() {
    const font = new FontFace('Kiineza', 'url(fonts/Kiineza_Laaitu.woff2)');
    try {
        await font.load();
        document.fonts.add(font);
        await document.fonts.ready;
        if (!document.fonts.check('16px Kiineza')) throw new Error();
        document.body.classList.add('fonts-loaded');
        document.querySelector('.loading-overlay').style.display = 'none';
    } catch {
        showErrorState();
    }
}

function showErrorState() {
    const overlay = document.querySelector('.loading-overlay');
    overlay.querySelector('.loading-symbol').style.display = 'none';
    overlay.querySelector('.error-symbol').style.display = 'block';
    overlay.querySelector('.retry-symbol').style.display = 'block';
}

document.querySelector('.retry-symbol').addEventListener('click', () => location.reload());
setTimeout(() => !document.body.classList.contains('fonts-loaded') && showErrorState(), 8000);

const keyboardLayout = [
    ['v','b','m'],
    ['t','d','n'],
    ['s','z','l'],
    ['k','g','h'],
    ['O','o','/'],
    ['U','u',','],
    ['E','e','.'],
    ['I','i','â£'],
    ['A','a','â†']
];
const kanaMap = {
  // v ç³»åˆ—
  "vo": "ãƒ´ã‚©", "vu": "ãƒ´", "ve": "ãƒ´ã‚§", "vi": "ãƒ´ã‚£", "va": "ãƒ´ã‚¡", 
  "vO": "ãƒ´ã‚©ãƒ¼", "vU": "ãƒ´ãƒ¼", "vE": "ãƒ´ã‚§ãƒ¼", "vI": "ãƒ´ã‚£ãƒ¼", "vA": "ãƒ´ã‚¡ãƒ¼",
  
  // b ç³»åˆ—
  "bo": "ãƒœ", "bu": "ãƒ–", "be": "ãƒ™", "bi": "ãƒ“", "ba": "ãƒ", 
  "bO": "ãƒœãƒ¼", "bU": "ãƒ–ãƒ¼", "bE": "ãƒ™ãƒ¼", "bI": "ãƒ“ãƒ¼", "bA": "ãƒãƒ¼",
  
  // m ç³»åˆ—
  "mo": "ãƒ¢", "mu": "ãƒ ", "me": "ãƒ¡", "mi": "ãƒŸ", "ma": "ãƒ", 
  "mO": "ãƒ¢ãƒ¼", "mU": "ãƒ ãƒ¼", "mE": "ãƒ¡ãƒ¼", "mI": "ãƒŸãƒ¼", "mA": "ãƒãƒ¼",
  
  // t ç³»åˆ—
  "to": "ãƒˆ", "tu": "ãƒˆã‚¥", "te": "ãƒ†", "ti": "ãƒ†ã‚£", "ta": "ã‚¿", 
  "tO": "ãƒˆãƒ¼", "tU": "ãƒˆã‚¥ãƒ¼", "tE": "ãƒ†ãƒ¼", "tI": "ãƒ†ã‚£ãƒ¼", "tA": "ã‚¿ãƒ¼",
  
  // d ç³»åˆ—
  "do": "ãƒ‰", "du": "ãƒ‰ã‚¥", "de": "ãƒ‡", "di": "ãƒ‡ã‚£", "da": "ãƒ€", 
  "dO": "ãƒ‰ãƒ¼", "dU": "ãƒ‰ã‚¥ãƒ¼", "dE": "ãƒ‡ãƒ¼", "dI": "ãƒ‡ã‚£ãƒ¼", "dA": "ãƒ€ãƒ¼",
  
  // n ç³»åˆ—
  "no": "ãƒ", "nu": "ãƒŒ", "ne": "ãƒ", "ni": "ãƒ‹", "na": "ãƒŠ", 
  "nO": "ãƒãƒ¼", "nU": "ãƒŒãƒ¼", "nE": "ãƒãƒ¼", "nI": "ãƒ‹ãƒ¼", "nA": "ãƒŠãƒ¼",
  
  // s ç³»åˆ—
  "so": "ã‚½", "su": "ã‚¹", "se": "ã‚»", "si": "ã‚¹ã‚£", "sa": "ã‚µ", 
  "sO": "ã‚½ãƒ¼", "sU": "ã‚¹ãƒ¼", "sE": "ã‚»ãƒ¼", "sI": "ã‚¹ã‚£ãƒ¼", "sA": "ã‚µãƒ¼",
  
  // z ç³»åˆ—
  "zo": "ã‚¾", "zu": "ãƒ…", "ze": "ã‚¼", "zi": "ãƒ…ã‚£", "za": "ã‚¶", 
  "zO": "ã‚¾ãƒ¼", "zU": "ãƒ…ãƒ¼", "zE": "ã‚¼ãƒ¼", "zI": "ãƒ…ã‚£ãƒ¼", "zA": "ã‚¶ãƒ¼",
  
  // l ç³»åˆ—
  "lo": "ãƒ­", "lu": "ãƒ«", "le": "ãƒ¬", "li": "ãƒª", "la": "ãƒ©", 
  "lO": "ãƒ­ãƒ¼", "lU": "ãƒ«ãƒ¼", "lE": "ãƒ¬ãƒ¼", "lI": "ãƒªãƒ¼", "lA": "ãƒ©ãƒ¼",
  
  // k ç³»åˆ—
  "ko": "ã‚³", "ku": "ã‚¯", "ke": "ã‚±", "ki": "ã‚­", "ka": "ã‚«", 
  "kO": "ã‚³ãƒ¼", "kU": "ã‚¯ãƒ¼", "kE": "ã‚±ãƒ¼", "kI": "ã‚­ãƒ¼", "kA": "ã‚«ãƒ¼",
  
  // g ç³»åˆ—
  "go": "ã‚´", "gu": "ã‚°", "ge": "ã‚²", "gi": "ã‚®", "ga": "ã‚¬", 
  "gO": "ã‚´ãƒ¼", "gU": "ã‚°ãƒ¼", "gE": "ã‚²ãƒ¼", "gI": "ã‚®ãƒ¼", "gA": "ã‚¬ãƒ¼",
  
  // h ç³»åˆ—
  "ho": "ãƒ›", "hu": "ãƒ•", "he": "ãƒ˜", "hi": "ãƒ’", "ha": "ãƒ", 
  "hO": "ãƒ›ãƒ¼", "hU": "ãƒ•ãƒ¼", "hE": "ãƒ˜ãƒ¼", "hI": "ãƒ’ãƒ¼", "hA": "ãƒãƒ¼",
  
  // x ç³»åˆ—
  "xo": "ã‚ª", "xu": "ã‚¦", "xe": "ã‚¨", "xi": "ã‚¤", "xa": "ã‚¢", 
  "xO": "ã‚ªãƒ¼", "xU": "ã‚¦ãƒ¼", "xE": "ã‚¨ãƒ¼", "xI": "ã‚¤ãƒ¼", "xA": "ã‚¢ãƒ¼",
  
  // å•ä¸ªè¾…éŸ³
  "v": "ãƒ´", "b": "ãƒ–", "m": "ãƒ ", "t": "ãƒˆã‚¥", "d": "ãƒ‰ã‚¥", 
  "n": "ãƒŒ", "s": "ã‚¹", "z": "ãƒ…", "l": "ãƒ«", "k": "ã‚¯", 
  "g": "ã‚°", "h": "ãƒ•"
};
// é˜»æ­¢ç‰©ç†é”®ç›˜è¾“å…¥
const display = document.getElementById('display');
display.addEventListener('keydown', e => e.preventDefault());
// æ’å…¥ x å‰ç¼€é€»è¾‘
function processInput(str) {
    const consonants = new Set(['x','v','b','m','t','d','n','s','z','l','k','g','h','/']);
    let output = [];
    for (let i = 0; i < str.length; i++) {
        const cur = str[i];
        if ('AEIOUaeiou'.includes(cur)) {
            if (i === 0 || !consonants.has(str[i-1].toLowerCase())) {
                output.push('x');
            }
        }
        output.push(cur);
    }
    return output.join('');
}
// åˆå§‹åŒ–é”®ç›˜
function initKeyboard() {
    const kb = document.getElementById('keyboard');
    keyboardLayout.forEach(col => {
        const colDiv = document.createElement('div');
        colDiv.className = 'key-column';
        col.forEach(ch => {
            const key = document.createElement('div');
            key.className = 'key ' + (/[AEIOUaeiou]/.test(ch) ? 'vowel-key' : '');
            key.className = 'key ' + (/[â£]/.test(ch) ? 'underbar-key' : '');
            key.dataset.char = ch;
            key.addEventListener('click', () => handleKey(ch));
            colDiv.appendChild(key);
        });
        kb.appendChild(colDiv);
    });
}
// å¤„ç†æŒ‰é”®
function handleKey(ch) {
    let val = display.value;
    if (ch === 'â†') {
      const val = display.value;
      if (!val) return;
      const lastChar = val[val.length - 1];
      if ('AEIOUaeiou'.includes(lastChar)) {
          display.value = val.slice(0, -2);
      } else {
          display.value = val.slice(0, -1);
      }
    } else if (ch === 'â£') {
        display.value = processInput((val + ' ').slice(0, 80));
    } else {
        display.value = processInput((val + ch).slice(0, 80));
    }
    display.focus();
    display.setSelectionRange(display.value.length, display.value.length);
}
// æ‹†éŸ³èŠ‚ä¸å‡åè½¬æ¢
function splitSylls(word) {
    const cons = /[vbmtdnszlkghx/]/i;
    const vow = /[AEIOUaeiou]/;
    let res = [], i = 0;
    while (i < word.length) {
        if (cons.test(word[i]) && vow.test(word[i+1])) {
            res.push(word.substr(i,2)); i+=2;
        } else if (vow.test(word[i])) {
            res.push(word[i]); i++;
        } else { res.push(word[i]); i++; }
    }
    return res;
}
function toKana(word) {
    return splitSylls(word).map(s => kanaMap[s] || '').join('');
}
// æœ—è¯»å¥å­
function speakSentence() {
    const text = display.value.trim(); if (!text) return;
    const words = text.split(/\s+/).map(w => w.replace(/\//g, ''));
    const kanaWords = words.map(w => toKana(w));
    const joined = kanaWords.join('ï¼›');
    const utter = new SpeechSynthesisUtterance(joined);
    utter.lang='ja-JP'; utter.rate=1; utter.pitch=1;utter.volume = 8;
    speechSynthesis.speak(utter);
    // ä¸ä¿®æ”¹æ˜¾ç¤ºå†…å®¹ï¼Œä¿ç•™åŠè§’æ ‡ç‚¹
}
// å¯åŠ¨
window.addEventListener('DOMContentLoaded', () => {
    initKeyboard();
    checkFontLoaded();
    display.focus();

    // å¦‚æœé¡µé¢åŠ è½½æ—¶å·²æœ‰ voicesï¼Œåˆ™ç«‹å³éšè— overlay
    if (speechSynthesis.getVoices().length > 0) {
        document.getElementById('voiceOverlay').style.display = 'none';
    }



    display.addEventListener('mousedown', e => {
        e.preventDefault(); // é˜»æ­¢é»˜è®¤ç‚¹å‡»è¡Œä¸º
        display.focus();
        display.setSelectionRange(display.value.length, display.value.length);
    });
    document.getElementById('readBtn').addEventListener('click', speakSentence);
    
   // ç‚¹å‡»â€œæˆ‘çŸ¥é“äº†â€æŒ‰é’®å…³é—­æç¤º
    document.getElementById('voiceDismiss').addEventListener('click', () => {
        location.reload(); 
    });

    // ç›‘å¬ voiceschanged äº‹ä»¶ï¼Œä¸€æ—¦æœ‰è¯­éŸ³åŒ…åˆ™éšè— overlay
    speechSynthesis.onvoiceschanged = () => {
        if (speechSynthesis.getVoices().length > 0) {
            document.getElementById('voiceOverlay').style.display = 'none';
        }
    };
});
</script>
</body>
</html>
