<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>V√∂is</title>
    <style>
        
        :root {
            --primary: #00b195;
            --secondary: #fc2537;
            --background: #07080b;
            --warning: #fc2537;
        }

        /* Âä†ËΩΩÁä∂ÊÄÅÊ†∑Âºè */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
        transform: none !important; /* Á¶ÅÁî®Áº©ÊîæÂΩ±Âìç */
            background: var(--background);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 3000;
            gap: 2rem;
        }

        .status-symbol {
            width: 80px;
            height: 80px;
            position: relative;
        }

        /* Âä†ËΩΩÂä®Áîª */
        .loading-symbol {
            border: 4px solid rgba(255,255,255,0.2);
            border-top-color: #fff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        /* ÈîôËØØÁ¨¶Âè∑ */
        .error-symbol::before,
        .error-symbol::after {
            content: '';
            position: absolute;
            background: var(--secondary);
            left: 50%;
            top: 50%;
            width: 40px;
            height: 4px;
            border-radius: 2px;
        }
        .error-symbol::before {
            transform: translate(-50%, -50%) rotate(45deg);
        }
        .error-symbol::after {
            transform: translate(-50%, -50%) rotate(-45deg);
        }

        /* Âà∑Êñ∞ÊåâÈíÆ */
        .retry-symbol {
            border: 4px solid #fff;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            width: 60px;  /* Ë∞ÉÊï¥Â∞∫ÂØ∏ */
            height: 60px;
            background: transparent;
        }


        .retry-symbol::before {
            content: none;
        }

        .retry-symbol:hover {
            transform: scale(1.1);  /* ÊÇ¨ÂÅúÊó∂ÊîæÂ§ß */
            border-color: var(--primary);  /* ÊÇ¨ÂÅúÊó∂Âèò‰∏∫‰∏ªËâ≤ */
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        
        body {
            margin: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: var(--background);
            font-family: 'Kiineza', monospace;
            color: white;
            line-height: 1;
        }
                /* Áº©ÊîæÂ§ÑÁêÜÔºöËßÜÂè£ÂÆΩÂ∫¶Â∞è‰∫é600pxÊó∂Êï¥‰ΩìÁº©Â∞èËá≥50% */
        @media (max-width: 1000px) or (orientation: portrait) {
            body {
                transform: scale(0.5);
                transform-origin: top left;
                width: 200%;
            }
        }
        .read-button {
            background: none;
            border: none;
            font-size: 6.52rem;
            color: var(--primary);
            cursor: pointer;
            margin-bottom: 1.2rem;
            transition: transform 0.2s;
        }
        .read-button:hover {
            transform: scale(1.05);
            text-shadow: 
                -3px -3px 0 var(--primary),
                 3px -3px 0 var(--primary),
                -3px  3px 0 var(--primary),
                 3px  3px 0 var(--primary);
        }
        .display-box {
            width: 100vw;
            max-width: 900px;
            padding: 1rem;
            font-size: 3.5rem;
            background: #131318;
            border: none;
            border-radius: 8px;
            color: var(--primary);
            font-family: 'Kiineza', monospace;
            outline: none;
            margin-bottom: 2rem;
            caret-color: var(--primary);
        }

        .display-box::placeholder {
            color: #303030; 
            opacity: 1; /* Á°Æ‰øùÈ¢úËâ≤‰∏çÈÄèÊòé */
        }

        .keyboard {
            display: flex;
            gap: 0.1rem;
            justify-content: center;
            max-width: 800px;
        }
        .key-column {
            display: flex;
            flex-direction: column;
            gap: 0.1rem;
        }
        .key {
            width: 5.4rem;
            height: 5.4rem;
            background: #131318;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4.2rem;
            transition: all 0.2s;
            position: relative;
            overflow: visible;
            cursor: pointer;
            font-family: 'Kiineza', monospace;
        }
        .key::after {
            content: attr(data-char);
            position: absolute;
            top: -0.7rem;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            pointer-events: none;
        }
        .key.vowel-key {
            font-size: 5.6rem;
            letter-spacing: -0.1rem;
        }
        .vowel-key::after {
            font-size: 5.6rem;
            top: -0.8rem;
        }
        
        .key.underbar-key {
            font-size: 4.2rem;
            letter-spacing: -0.1rem;
        }
        .underbar-key::after {
            font-size: 4.2rem;
            top: -1.5rem;
        }
        .key:hover { background: var(--primary); color: var(--background); }
        /* ËØ≠Èü≥ÂåÖÊèêÁ§∫ÂºπÁ™óÊ†∑Âºè */
        .voice-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(7,8,11,0.95);
            align-items: center;
            justify-content: center;
            z-index: 2000;
            text-align: center;
            padding: 2rem;
            font-family: 'Kiineza', monospace;
        }
        .voice-prompt {
            background: #131318;
            border: 2px solid var(--primary);
            border-radius: 8px;
            padding: 1.5rem;
            max-width: 90vw;
            color: white;
            font-size: 2.2rem;
            line-height: 1.2;
            font-family: 'Kiineza', monospace;
            color: var(--warning);
        }
        .voice-prompt button {
            margin-top: 1rem;
            background: var(--primary);
            border: none;
            padding: 0.5rem 1rem;
            font-size: 1.4rem;
            border-radius: 6px;
            cursor: pointer;
            font-family: 'Kiineza', monospace;
        }
    </style>
</head>
<body>
    <div class="loading-overlay">
        <div class="status-symbol loading-symbol"></div>
        <div class="status-symbol error-symbol" style="display: none;"></div>
        <button class="status-symbol retry-symbol" style="display: none;"></button>
    </div>
    <button class="read-button" id="readBtn">üó£Ô∏è</button>
    <input type="text" id="display" class="display-box" maxlength="80" placeholder="lO sivOxis/u maz/e vOz/ot/i...">
    <div id="keyboard" class="keyboard"></div>
    <!-- ËØ≠Èü≥ÊèêÁ§∫ÂºπÁ™ó -->
    <div id="voiceOverlay" class="voice-overlay">
        <div class="voice-prompt">
            <p>‚ùåvOsut‚ùå</p>
            <p>lO tigAxun/a masIn/u üñ•Ô∏è s/ot/i.</p>
            <button id="voiceDismiss">mal/o kak/u n/og/i.</button>
        </div>
    </div>
<script>


async function checkFontLoaded() {
    const font = new FontFace('Kiineza', 'url(fonts/Kiineza_Laaitu.woff2)');
    try {
        await font.load();
        document.fonts.add(font);
        await document.fonts.ready;
        if (!document.fonts.check('16px Kiineza')) throw new Error();
        document.body.classList.add('fonts-loaded');
        document.querySelector('.loading-overlay').style.display = 'none';
    } catch {
        showErrorState();
    }
}

function showErrorState() {
    const overlay = document.querySelector('.loading-overlay');
    overlay.querySelector('.loading-symbol').style.display = 'none';
    overlay.querySelector('.error-symbol').style.display = 'block';
    overlay.querySelector('.retry-symbol').style.display = 'block';
}

document.querySelector('.retry-symbol').addEventListener('click', () => location.reload());
setTimeout(() => !document.body.classList.contains('fonts-loaded') && showErrorState(), 8000);

const keyboardLayout = [
    ['v','b','m'],
    ['t','d','n'],
    ['s','z','l'],
    ['k','g','h'],
    ['O','o','/'],
    ['U','u',','],
    ['E','e','.'],
    ['I','i','‚ê£'],
    ['A','a','‚Üê']
];
const kanaMap = {
  // v Á≥ªÂàó
  "vo": "„É¥„Ç©", "vu": "„É¥", "ve": "„É¥„Çß", "vi": "„É¥„Ç£", "va": "„É¥„Ç°", 
  "vO": "„É¥„Ç©„Éº", "vU": "„É¥„Éº", "vE": "„É¥„Çß„Éº", "vI": "„É¥„Ç£„Éº", "vA": "„É¥„Ç°„Éº",
  
  // b Á≥ªÂàó
  "bo": "„Éú", "bu": "„Éñ", "be": "„Éô", "bi": "„Éì", "ba": "„Éê", 
  "bO": "„Éú„Éº", "bU": "„Éñ„Éº", "bE": "„Éô„Éº", "bI": "„Éì„Éº", "bA": "„Éê„Éº",
  
  // m Á≥ªÂàó
  "mo": "„É¢", "mu": "„É†", "me": "„É°", "mi": "„Éü", "ma": "„Éû", 
  "mO": "„É¢„Éº", "mU": "„É†„Éº", "mE": "„É°„Éº", "mI": "„Éü„Éº", "mA": "„Éû„Éº",
  
  // t Á≥ªÂàó
  "to": "„Éà", "tu": "„Éà„Ç•", "te": "„ÉÜ", "ti": "„ÉÜ„Ç£", "ta": "„Çø", 
  "tO": "„Éà„Éº", "tU": "„Éà„Ç•„Éº", "tE": "„ÉÜ„Éº", "tI": "„ÉÜ„Ç£„Éº", "tA": "„Çø„Éº",
  
  // d Á≥ªÂàó
  "do": "„Éâ", "du": "„Éâ„Ç•", "de": "„Éá", "di": "„Éá„Ç£", "da": "„ÉÄ", 
  "dO": "„Éâ„Éº", "dU": "„Éâ„Ç•„Éº", "dE": "„Éá„Éº", "dI": "„Éá„Ç£„Éº", "dA": "„ÉÄ„Éº",
  
  // n Á≥ªÂàó
  "no": "„Éé", "nu": "„Éå", "ne": "„Éç", "ni": "„Éã", "na": "„Éä", 
  "nO": "„Éé„Éº", "nU": "„Éå„Éº", "nE": "„Éç„Éº", "nI": "„Éã„Éº", "nA": "„Éä„Éº",
  
  // s Á≥ªÂàó
  "so": "„ÇΩ", "su": "„Çπ", "se": "„Çª", "si": "„Çπ„Ç£", "sa": "„Çµ", 
  "sO": "„ÇΩ„Éº", "sU": "„Çπ„Éº", "sE": "„Çª„Éº", "sI": "„Çπ„Ç£„Éº", "sA": "„Çµ„Éº",
  
  // z Á≥ªÂàó
  "zo": "„Çæ", "zu": "„ÉÖ", "ze": "„Çº", "zi": "„ÉÖ„Ç£", "za": "„Ç∂", 
  "zO": "„Çæ„Éº", "zU": "„ÉÖ„Éº", "zE": "„Çº„Éº", "zI": "„ÉÖ„Ç£„Éº", "zA": "„Ç∂„Éº",
  
  // l Á≥ªÂàó
  "lo": "„É≠", "lu": "„É´", "le": "„É¨", "li": "„É™", "la": "„É©", 
  "lO": "„É≠„Éº", "lU": "„É´„Éº", "lE": "„É¨„Éº", "lI": "„É™„Éº", "lA": "„É©„Éº",
  
  // k Á≥ªÂàó
  "ko": "„Ç≥", "ku": "„ÇØ", "ke": "„Ç±", "ki": "„Ç≠", "ka": "„Ç´", 
  "kO": "„Ç≥„Éº", "kU": "„ÇØ„Éº", "kE": "„Ç±„Éº", "kI": "„Ç≠„Éº", "kA": "„Ç´„Éº",
  
  // g Á≥ªÂàó
  "go": "„Ç¥", "gu": "„Ç∞", "ge": "„Ç≤", "gi": "„ÇÆ", "ga": "„Ç¨", 
  "gO": "„Ç¥„Éº", "gU": "„Ç∞„Éº", "gE": "„Ç≤„Éº", "gI": "„ÇÆ„Éº", "gA": "„Ç¨„Éº",
  
  // h Á≥ªÂàó
  "ho": "„Éõ", "hu": "„Éï", "he": "„Éò", "hi": "„Éí", "ha": "„Éè", 
  "hO": "„Éõ„Éº", "hU": "„Éï„Éº", "hE": "„Éò„Éº", "hI": "„Éí„Éº", "hA": "„Éè„Éº",
  
  // x Á≥ªÂàó
  "xo": "„Ç™", "xu": "„Ç¶", "xe": "„Ç®", "xi": "„Ç§", "xa": "„Ç¢", 
  "xO": "„Ç™„Éº", "xU": "„Ç¶„Éº", "xE": "„Ç®„Éº", "xI": "„Ç§„Éº", "xA": "„Ç¢„Éº",
  
  // Âçï‰∏™ËæÖÈü≥
  "v": "„É¥", "b": "„Éñ", "m": "„É†", "t": "„Éà„Ç•", "d": "„Éâ„Ç•", 
  "n": "„Éå", "s": "„Çπ", "z": "„ÉÖ", "l": "„É´", "k": "„ÇØ", 
  "g": "„Ç∞", "h": "„Éï"
};
// ÈòªÊ≠¢Áâ©ÁêÜÈîÆÁõòËæìÂÖ•
const display = document.getElementById('display');
display.addEventListener('keydown', e => e.preventDefault());
// ÊèíÂÖ• x ÂâçÁºÄÈÄªËæë
function processInput(str) {
    const consonants = new Set(['x','v','b','m','t','d','n','s','z','l','k','g','h','/']);
    let output = [];
    for (let i = 0; i < str.length; i++) {
        const cur = str[i];
        if ('AEIOUaeiou'.includes(cur)) {
            if (i === 0 || !consonants.has(str[i-1].toLowerCase())) {
                output.push('x');
            }
        }
        output.push(cur);
    }
    return output.join('');
}
// ÂàùÂßãÂåñÈîÆÁõò
function initKeyboard() {
    const kb = document.getElementById('keyboard');
    keyboardLayout.forEach(col => {
        const colDiv = document.createElement('div');
        colDiv.className = 'key-column';
        col.forEach(ch => {
            const key = document.createElement('div');
            key.className = 'key ' + (/[AEIOUaeiou]/.test(ch) ? 'vowel-key' : '');
            key.className = 'key ' + (/[‚ê£]/.test(ch) ? 'underbar-key' : '');
            key.dataset.char = ch;
            key.addEventListener('click', () => handleKey(ch));
            colDiv.appendChild(key);
        });
        kb.appendChild(colDiv);
    });
}
// Â§ÑÁêÜÊåâÈîÆ
function handleKey(ch) {
    let val = display.value;
    if (ch === '‚Üê') {
      const val = display.value;
      if (!val) return;
      const lastChar = val[val.length - 1];
      if ('AEIOUaeiou'.includes(lastChar)) {
          display.value = val.slice(0, -2);
      } else {
          display.value = val.slice(0, -1);
      }
    } else if (ch === '‚ê£') {
        display.value = processInput((val + ' ').slice(0, 80));
    } else {
        display.value = processInput((val + ch).slice(0, 80));
    }
    display.focus();
    display.setSelectionRange(display.value.length, display.value.length);
}
// ÊãÜÈü≥ËäÇ‰∏éÂÅáÂêçËΩ¨Êç¢
function splitSylls(word) {
    const cons = /[vbmtdnszlkghx/]/i;
    const vow = /[AEIOUaeiou]/;
    let res = [], i = 0;
    while (i < word.length) {
        if (cons.test(word[i]) && vow.test(word[i+1])) {
            res.push(word.substr(i,2)); i+=2;
        } else if (vow.test(word[i])) {
            res.push(word[i]); i++;
        } else { res.push(word[i]); i++; }
    }
    return res;
}
function toKana(word) {
    return splitSylls(word).map(s => kanaMap[s] || '').join('');
}
// ÊúóËØªÂè•Â≠ê
function speakSentence() {
    const text = display.value.trim(); if (!text) return;
    const words = text.split(/\s+/).map(w => w.replace(/\//g, ''));
    const kanaWords = words.map(w => toKana(w));
    const joined = kanaWords.join('Ôºõ');
    const utter = new SpeechSynthesisUtterance(joined);
    utter.lang='ja-JP'; utter.rate=1; utter.pitch=1;utter.volume = 8;
    speechSynthesis.speak(utter);
    // ‰∏ç‰øÆÊîπÊòæÁ§∫ÂÜÖÂÆπÔºå‰øùÁïôÂçäËßíÊ†áÁÇπ
}
// ÂêØÂä®
window.addEventListener('DOMContentLoaded', () => {
    initKeyboard();
    checkFontLoaded();
    display.focus();

    // Â¶ÇÊûúÈ°µÈù¢Âä†ËΩΩÊó∂Â∑≤Êúâ voicesÔºåÂàôÁ´ãÂç≥ÈöêËóè overlay
    if (speechSynthesis.getVoices().length > 0) {
        document.getElementById('voiceOverlay').style.display = 'none';
    }



    display.addEventListener('mousedown', e => {
        e.preventDefault(); // ÈòªÊ≠¢ÈªòËÆ§ÁÇπÂáªË°å‰∏∫
        display.focus();
        display.setSelectionRange(display.value.length, display.value.length);
    });
    document.getElementById('readBtn').addEventListener('click', speakSentence);
    
   // ÁÇπÂáª‚ÄúÊàëÁü•ÈÅì‰∫Ü‚ÄùÊåâÈíÆÂÖ≥Èó≠ÊèêÁ§∫
    document.getElementById('voiceDismiss').addEventListener('click', () => {
        location.reload(); 
    });

    // ÁõëÂê¨ voiceschanged ‰∫ã‰ª∂Ôºå‰∏ÄÊó¶ÊúâËØ≠Èü≥ÂåÖÂàôÈöêËóè overlay
    speechSynthesis.onvoiceschanged = () => {
        if (speechSynthesis.getVoices().length > 0) {
            document.getElementById('voiceOverlay').style.display = 'none';
        }
    };
});
</script>
</body>
</html>
